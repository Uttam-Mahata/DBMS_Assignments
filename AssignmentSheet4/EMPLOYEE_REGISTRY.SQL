CREATE DATABASE EMPLOYEE_REGISTRY;

USE EMPLOYEE_REGISTRY;

CREATE TABLE DEPARTMENT (
    DEPARTMENT_NO VARCHAR(8) CHECK ( DEPARTMENT_NO LIKE 'D%') PRIMARY KEY,
    DEPARTMENT_NAME ENUM ('ACCOUNTING', 'RESEARCH', 'SALES', 'OPERATIONS') NOT NULL,
    DEPARTMENT_LOCATION ENUM ('NEW YORK', 'DALLAS', 'CHICAGO', 'BOSTON') NOT NULL
);

CREATE TABLE EMPLOYEE (
    EMPLOYEE_NO INT CHECK ( EMPLOYEE_NO > 7000 AND EMPLOYEE_NO < 8000 ) PRIMARY KEY,
    EMPLOYEE_NAME VARCHAR(50) NOT NULL,
    EMPLOYEE_JOB ENUM ('CLERK', 'SALESMAN', 'MANAGER', 'ANALYST', 'PRESIDENT') NOT NULL,
    EMPLOYEE_MANAGER INT,
    FOREIGN KEY (EMPLOYEE_MANAGER) REFERENCES EMPLOYEE(EMPLOYEE_NO),
    EMPLOYEE_HIREDATE DATE NOT NULL,
    EMPLOYEE_SALARY DECIMAL(7,2) NOT NULL,
    EMPLOYEE_COMM DECIMAL(7,2) CHECK ( EMPLOYEE_COMM < 1500 ) DEFAULT 0.00,
    DEPARTMENT_NO VARCHAR(8) NOT NULL,
    FOREIGN KEY (DEPARTMENT_NO) REFERENCES DEPARTMENT(DEPARTMENT_NO)


);



-- DEPARTMENT table data
INSERT INTO DEPARTMENT (DEPARTMENT_NO, DEPARTMENT_NAME, DEPARTMENT_LOCATION) VALUES
('D101', 'ACCOUNTING', 'NEW YORK'),
('D201', 'RESEARCH', 'DALLAS'),
('D301', 'SALES', 'CHICAGO'),
('D401', 'OPERATIONS', 'BOSTON'),
('D102', 'ACCOUNTING', 'NEW YORK'),
('D202', 'RESEARCH', 'DALLAS'),
('D302', 'SALES', 'CHICAGO'),
('D402', 'OPERATIONS', 'BOSTON'),
('D103', 'ACCOUNTING', 'NEW YORK'),
('D203', 'RESEARCH', 'DALLAS'),
('D303', 'SALES', 'CHICAGO'),
('D403', 'OPERATIONS', 'BOSTON'),
('D104', 'ACCOUNTING', 'NEW YORK'),
('D204', 'RESEARCH', 'DALLAS'),
('D304', 'SALES', 'CHICAGO'),
('D404', 'OPERATIONS', 'BOSTON'),
('D105', 'ACCOUNTING', 'NEW YORK'),
('D205', 'RESEARCH', 'DALLAS'),
('D305', 'SALES', 'CHICAGO'),
('D405', 'OPERATIONS', 'BOSTON'),
('D106', 'ACCOUNTING', 'NEW YORK'),
('D206', 'RESEARCH', 'DALLAS'),
('D306', 'SALES', 'CHICAGO'),
('D406', 'OPERATIONS', 'BOSTON'),
('D107', 'ACCOUNTING', 'NEW YORK'),
('D207', 'RESEARCH', 'DALLAS'),
('D307', 'SALES', 'CHICAGO'),
('D407', 'OPERATIONS', 'BOSTON'),
('D108', 'ACCOUNTING', 'NEW YORK'),
('D208', 'RESEARCH', 'DALLAS'),
('D308', 'SALES', 'CHICAGO'),
('D408', 'OPERATIONS', 'BOSTON'),
('D109', 'ACCOUNTING', 'NEW YORK'),
('D209', 'RESEARCH', 'DALLAS'),
('D309', 'SALES', 'CHICAGO'),
('D409', 'OPERATIONS', 'BOSTON'),
('D110', 'ACCOUNTING', 'NEW YORK'),
('D210', 'RESEARCH', 'DALLAS'),
('D310', 'SALES', 'CHICAGO'),
('D410', 'OPERATIONS', 'BOSTON'),
('D111', 'ACCOUNTING', 'NEW YORK'),
('D211', 'RESEARCH', 'DALLAS'),
('D311', 'SALES', 'CHICAGO'),
('D411', 'OPERATIONS', 'BOSTON'),
('D112', 'ACCOUNTING', 'NEW YORK'),
('D212', 'RESEARCH', 'DALLAS'),
('D312', 'SALES', 'CHICAGO'),
('D412', 'OPERATIONS', 'BOSTON'),
('D113', 'ACCOUNTING', 'NEW YORK'),
('D213', 'RESEARCH', 'DALLAS'),
('D313', 'SALES', 'CHICAGO'),
('D413', 'OPERATIONS', 'BOSTON'),
('D114', 'ACCOUNTING', 'NEW YORK'),
('D214', 'RESEARCH', 'DALLAS'),
('D314', 'SALES', 'CHICAGO'),
('D414', 'OPERATIONS', 'BOSTON'),
('D115', 'ACCOUNTING', 'NEW YORK'),
('D215', 'RESEARCH', 'DALLAS'),
('D315', 'SALES', 'CHICAGO'),
('D415', 'OPERATIONS', 'BOSTON'),
('D116', 'ACCOUNTING', 'NEW YORK'),
('D216', 'RESEARCH', 'DALLAS'),
('D316', 'SALES', 'CHICAGO'),
('D416', 'OPERATIONS', 'BOSTON'),
('D117', 'ACCOUNTING', 'NEW YORK'),
('D217', 'RESEARCH', 'DALLAS'),
('D317', 'SALES', 'CHICAGO'),
('D417', 'OPERATIONS', 'BOSTON'),
('D118', 'ACCOUNTING', 'NEW YORK'),
('D218', 'RESEARCH', 'DALLAS'),
('D318', 'SALES', 'CHICAGO'),
('D418', 'OPERATIONS', 'BOSTON'),
('D119', 'ACCOUNTING', 'NEW YORK'),
('D219', 'RESEARCH', 'DALLAS'),
('D319', 'SALES', 'CHICAGO'),
('D419', 'OPERATIONS', 'BOSTON'),
('D120', 'ACCOUNTING', 'NEW YORK'),
('D220', 'RESEARCH', 'DALLAS'),
('D320', 'SALES', 'CHICAGO'),
('D420', 'OPERATIONS', 'BOSTON');

-- EMPLOYEE table data
INSERT INTO EMPLOYEE (EMPLOYEE_NO, EMPLOYEE_NAME, EMPLOYEE_JOB, EMPLOYEE_MANAGER, EMPLOYEE_HIREDATE, EMPLOYEE_SALARY, EMPLOYEE_COMM, DEPARTMENT_NO) VALUES
(7001, 'JAMES', 'CLERK', NULL, '2023-01-01', 1200.00, 0.00, 'D101'),
(7002, 'JOHN', 'SALESMAN', 7001, '2023-02-02', 1600.00, 300.00, 'D301'),
(7003, 'MARY', 'SALESMAN', 7001, '2023-03-03', 1250.00, 500.00, 'D302'),
(7004, 'ROBERT', 'CLERK', NULL, '2023-04-04', 950.00, 0.00, 'D102'),
(7005, 'MICHAEL', 'SALESMAN', 7001, '2023-05-05', 1500.00, 700.00, 'D303'),
(7006, 'LINDA', 'CLERK', NULL, '2023-06-06', 1700.00, 0.00, 'D103'),
(7007, 'DAVID', 'MANAGER', NULL, '2023-07-07', 2400.00, 0.00, 'D104'),
(7008, 'BARBARA', 'ANALYST', 7007, '2023-08-08', 1600.00, 0.00, 'D201'),
(7009, 'CHARLES', 'SALESMAN', 7001, '2023-09-09', 1300.00, 0.00, 'D304'),
(7010, 'SUSAN', 'CLERK', NULL, '2023-10-10', 1100.00, 0.00, 'D105'),
(7011, 'THOMAS', 'SALESMAN', 7001, '2023-11-11', 1400.00, 100.00, 'D305'),
(7012, 'MARTHA', 'CLERK', NULL, '2023-12-12', 1100.00, 0.00, 'D106'),
(7013, 'GEORGE', 'SALESMAN', 7001, '2024-01-01', 1400.00, 400.00, 'D306'),
(7014, 'ANNA', 'CLERK', NULL, '2024-02-02', 1000.00, 0.00, 'D107'),
(7015, 'PAUL', 'SALESMAN', 7001, '2024-03-03', 1300.00, 200.00, 'D307'),
(7016, 'ALICE', 'SALESMAN', 7001, '2024-04-04', 1500.00, 600.00, 'D308'),
(7017, 'RICHARD', 'CLERK', NULL, '2024-05-05', 1000.00, 0.00, 'D108'),
(7018, 'FRANK', 'SALESMAN', 7001, '2024-06-06', 1500.00, 500.00, 'D309'),
(7019, 'MARIE', 'CLERK', NULL, '2024-07-07', 1200.00, 0.00, 'D109'),
(7020, 'FRED', 'SALESMAN', 7001, '2024-08-08', 1400.00, 300.00, 'D310'),
(7021, 'SANDRA', 'CLERK', NULL, '2024-09-09', 1100.00, 0.00, 'D110'),
(7022, 'DANIEL', 'SALESMAN', 7001, '2024-10-10', 1300.00, 100.00, 'D311'),
(7023, 'PATRICIA', 'CLERK', NULL, '2024-11-11', 1000.00, 0.00, 'D111'),
(7024, 'JACK', 'SALESMAN', 7001, '2024-12-12', 1600.00, 400.00, 'D312'),
(7025, 'KAREN', 'CLERK', NULL, '2025-01-01', 1200.00, 0.00, 'D112'),
(7026, 'MARTIN', 'SALESMAN', 7001, '2025-02-02', 1200.00, 200.00, 'D313'),
(7027, 'BETTY', 'CLERK', NULL, '2025-03-03', 1000.00, 0.00, 'D113'),
(7028, 'HARRY', 'SALESMAN', 7001, '2025-04-04', 1500.00, 500.00, 'D314'),
(7029, 'ALICE', 'CLERK', NULL, '2025-05-05', 1100.00, 0.00, 'D114'),
(7030, 'JOE', 'SALESMAN', 7001, '2025-06-06', 1300.00, 300.00, 'D315'),
(7031, 'HELEN', 'CLERK', NULL, '2025-07-07', 1000.00, 0.00, 'D115'),
(7032, 'WILLIAM', 'SALESMAN', 7001, '2025-08-08', 1400.00, 100.00, 'D316'),
(7033, 'CAROL', 'CLERK', NULL, '2025-09-09', 1200.00, 0.00, 'D116'),
(7034, 'RONALD', 'SALESMAN', 7001, '2025-10-10', 1300.00, 400.00, 'D317'),
(7035, 'MARGARET', 'CLERK', NULL, '2025-11-11', 1100.00, 0.00, 'D117'),
(7036, 'DON', 'SALESMAN', 7001, '2025-12-12', 1400.00, 200.00, 'D318'),
(7037, 'DORA', 'CLERK', NULL, '2026-01-01', 1000.00, 0.00, 'D118'),
(7038, 'BILL', 'SALESMAN', 7001, '2026-02-02', 1500.00, 500.00, 'D319'),
(7039, 'JEAN', 'CLERK', NULL, '2026-03-03', 1100.00, 0.00, 'D119'),
(7040, 'EDWARD', 'SALESMAN', 7001, '2026-04-04', 1300.00, 300.00, 'D320'),
(7041, 'GRACE', 'ANALYST', 7007, '2026-05-05', 1500.00, 0.00, 'D202'),
(7042, 'RICHARD', 'ANALYST', 7007, '2026-06-06', 1600.00, 0.00, 'D203'),
(7043, 'FRANK', 'ANALYST', 7007, '2026-07-07', 1400.00, 0.00, 'D204'),
(7044, 'MARIE', 'ANALYST', 7007, '2026-08-08', 1700.00, 0.00, 'D205'),
(7045, 'FRED', 'ANALYST', 7007, '2026-09-09', 1800.00, 0.00, 'D206'),
(7046, 'SANDRA', 'ANALYST', 7007, '2026-10-10', 1600.00, 0.00, 'D207'),
(7047, 'DANIEL', 'ANALYST', 7007, '2026-11-11', 1500.00, 0.00, 'D208'),
(7048, 'PATRICIA', 'ANALYST', 7007, '2026-12-12', 1700.00, 0.00, 'D209'),
(7049, 'JACK', 'ANALYST', 7007, '2027-01-01', 1900.00, 0.00, 'D210'),
(7050, 'KAREN', 'ANALYST', 7007, '2027-02-02', 1600.00, 0.00, 'D211'),
(7051, 'MARTIN', 'ANALYST', 7007, '2027-03-03', 1500.00, 0.00, 'D212'),
(7052, 'BETTY', 'ANALYST', 7007, '2027-04-04', 1700.00, 0.00, 'D213'),
(7053, 'HARRY', 'ANALYST', 7007, '2027-05-05', 1800.00, 0.00, 'D214'),
(7054, 'ALICE', 'ANALYST', 7007, '2027-06-06', 1600.00, 0.00, 'D215'),
(7055, 'JOE', 'ANALYST', 7007, '2027-07-07', 1500.00, 0.00, 'D216'),
(7056, 'HELEN', 'ANALYST', 7007, '2027-08-08', 1700.00, 0.00, 'D217'),
(7057, 'WILLIAM', 'ANALYST', 7007, '2027-09-09', 1900.00, 0.00, 'D218'),
(7058, 'CAROL', 'ANALYST', 7007, '2027-10-10', 1600.00, 0.00, 'D219'),
(7059, 'RONALD', 'ANALYST', 7007, '2027-11-11', 1500.00, 0.00, 'D220'),
(7060, 'MARGARET', 'MANAGER', NULL, '2027-12-12', 2800.00, 0.00, 'D401'),
(7061, 'DON', 'PRESIDENT', NULL, '2028-01-01', 5000.00, 0.00, 'D402'),
(7062, 'DORA', 'MANAGER', NULL, '2028-02-02', 2600.00, 0.00, 'D403'),
(7063, 'BILL', 'MANAGER', NULL, '2028-03-03', 2400.00, 0.00, 'D404'),
(7064, 'JEAN', 'MANAGER', NULL, '2028-04-04', 2500.00, 0.00, 'D405'),
(7065, 'EDWARD', 'MANAGER', NULL, '2028-05-05', 2700.00, 0.00, 'D406'),
(7066, 'GRACE', 'MANAGER', NULL, '2028-06-06', 2900.00, 0.00, 'D407'),
(7067, 'RICHARD', 'MANAGER', NULL, '2028-07-07', 2600.00, 0.00, 'D408'),
(7068, 'FRANK', 'MANAGER', NULL, '2028-08-08', 2400.00, 0.00, 'D409'),
(7069, 'MARIE', 'MANAGER', NULL, '2028-09-09', 2500.00, 0.00, 'D410'),
(7070, 'FRED', 'MANAGER', NULL, '2028-10-10', 2700.00, 0.00, 'D411'),
(7071, 'SANDRA', 'MANAGER', NULL, '2028-11-11', 2900.00, 0.00, 'D412'),
(7072, 'DANIEL', 'MANAGER', NULL, '2028-12-12', 2600.00, 0.00, 'D413'),
(7073, 'PATRICIA', 'MANAGER', NULL, '2029-01-01', 2400.00, 0.00, 'D414'),
(7074, 'JACK', 'MANAGER', NULL, '2029-02-02', 2500.00, 0.00, 'D415'),
(7075, 'KAREN', 'MANAGER', NULL, '2029-03-03', 2700.00, 0.00, 'D416'),
(7076, 'MARTIN', 'MANAGER', NULL, '2029-04-04', 2900.00, 0.00, 'D417'),
(7077, 'BETTY', 'MANAGER', NULL, '2029-05-05', 2600.00, 0.00, 'D418'),
(7078, 'HARRY', 'MANAGER', NULL, '2029-06-06', 2400.00, 0.00, 'D419'),
(7079, 'ALICE', 'MANAGER', NULL, '2029-07-07', 2500.00, 0.00, 'D420');


-- Display the difference between highest and lowest salary of each department in descending order. Label the column as “Difference”.

SELECT DEPARTMENT_NO, MAX(EMPLOYEE_SALARY) - MIN(EMPLOYEE_SALARY) AS Difference
FROM EMPLOYEE
GROUP BY DEPARTMENT_NO
ORDER BY Difference DESC;

--  List all the employees’ employee number and name along with their immediate managers’ employee number and name.
SELECT E1.EMPLOYEE_NO,
       E1.EMPLOYEE_NAME,
       E2.EMPLOYEE_NO AS MANAGER_NO,
       E2.EMPLOYEE_NAME AS MANAGER_NAME
FROM EMPLOYEE E1, EMPLOYEE E2
WHERE E1.EMPLOYEE_MANAGER = E2.EMPLOYEE_NO;

-- Create a query that will display the total number of employees and the total number of employees who were hired only in 2020. Give the column headings as “TOTAL” and “TOTAL_2020” respectively.

SELECT COUNT(EMPLOYEE_NO) AS TOTAL,
       COUNT(CASE WHEN YEAR(EMPLOYEE_HIREDATE) = 2020 THEN EMPLOYEE_NO END) AS TOTAL_2020
FROM EMPLOYEE;

---- Alternative

SELECT 'TOTAL' AS CATEGORY, COUNT(EMPLOYEE_NO) AS COUNT
FROM EMPLOYEE

UNION ALL

SELECT 'TOTAL_2020' AS CATEGORY, COUNT(EMPLOYEE_NO) AS COUNT
FROM EMPLOYEE
WHERE EMPLOYEE_HIREDATE >= '2020-01-01' AND EMPLOYEE_HIREDATE <= '2020-12-31';

--  Display the manager number and the salary of the lowest paid employee under that manager. Exclude anyone whose manager is not known. Exclude any group where the minimum salaryis less than 1000. Sort the output in descending order of salary.
SELECT EMPLOYEE_MANAGER, MIN(EMPLOYEE_SALARY) AS MIN_SALARY
FROM EMPLOYEE
WHERE EMPLOYEE_MANAGER IS NOT NULL
GROUP BY EMPLOYEE_MANAGER
HAVING MIN(EMPLOYEE_SALARY) >= 1000
ORDER BY MIN_SALARY DESC;


-- Assume that there are some departments where no employee is assigned. Now, write
-- a query to display the department name, location name, number of employees, and the
-- average salary for all the employees in that department. Label the columns as
-- “DNAME”, “LOCATION”, “NUMBER OF PEOPLE”, and “AVERAGE SALARY”
-- respectively. Round the averge salary to two decimal places. The outcome of the
-- query must include the details of the departments where no employee is assigned and
-- in that case the “AVERAGE SALARY” for that department is to be displayed as 0
-- (zero).

-- Query to get departments with employees
SELECT D.DEPARTMENT_NAME AS DNAME,
       D.DEPARTMENT_LOCATION AS LOCATION,
       COUNT(E.EMPLOYEE_NO) AS 'NUMBER OF PEOPLE',
       ROUND(AVG(E.EMPLOYEE_SALARY), 2) AS 'AVERAGE SALARY'
FROM DEPARTMENT D
JOIN EMPLOYEE E ON D.DEPARTMENT_NO = E.DEPARTMENT_NO
GROUP BY D.DEPARTMENT_NAME, D.DEPARTMENT_LOCATION

UNION ALL

-- Query to get departments without employees
SELECT D.DEPARTMENT_NAME AS DNAME,
       D.DEPARTMENT_LOCATION AS LOCATION,
       0 AS 'NUMBER OF PEOPLE',
       0 AS 'AVERAGE SALARY'
FROM DEPARTMENT D
WHERE D.DEPARTMENT_NO NOT IN (
    SELECT DISTINCT E.DEPARTMENT_NO
    FROM EMPLOYEE E
);

